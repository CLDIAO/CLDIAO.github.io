<!DOCTYPE html>
<html>
<head>
 <meta name="baidu-site-verification" content="d8vuriatOq" />
 <meta name="google-site-verification" content="ZKzrltgUA1iKyVKyH5hNp1TzVg-9LIJqbb09vFyUcWg" />
  <meta charset="utf-8">
  

  
  <title>RNA-Seq analysis in R(EDITING) | Rumble&#39;s blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="RNA-Seq analysis in RSome preparation:Packages used:limma edgeR gplots org.Mm.eg.db RColorBrewer Glimma">
<meta name="keywords" content="LINUX, VMware, RNA-Seq, R">
<meta property="og:type" content="article">
<meta property="og:title" content="RNA-Seq analysis in R(EDITING)">
<meta property="og:url" content="https://cldiao.github.io/2018/07/29/RNA-Seq analysis in R/index.html">
<meta property="og:site_name" content="Rumble&#39;s blog">
<meta property="og:description" content="RNA-Seq analysis in RSome preparation:Packages used:limma edgeR gplots org.Mm.eg.db RColorBrewer Glimma">
<meta property="og:locale" content="default">
<meta property="og:updated_time" content="2018-09-02T16:10:20.899Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="RNA-Seq analysis in R(EDITING)">
<meta name="twitter:description" content="RNA-Seq analysis in RSome preparation:Packages used:limma edgeR gplots org.Mm.eg.db RColorBrewer Glimma">
  
    <link rel="alternate" href="/atom.xml" title="Rumble&#39;s blog" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/css/style.css">
</head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Rumble&#39;s blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Stay hungry, stay foolish.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
          <a class="main-nav-link" href="/about">About</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="https://cldiao.github.io"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-RNA-Seq analysis in R" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2018/07/29/RNA-Seq analysis in R/" class="article-date">
  <time datetime="2018-07-28T16:28:44.000Z" itemprop="datePublished">2018-07-29</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      RNA-Seq analysis in R(EDITING)
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="RNA-Seq-analysis-in-R"><a href="#RNA-Seq-analysis-in-R" class="headerlink" title="RNA-Seq analysis in R"></a>RNA-Seq analysis in R</h1><h2 id="Some-preparation"><a href="#Some-preparation" class="headerlink" title="Some preparation:"></a>Some preparation:</h2><h3 id="Packages-used"><a href="#Packages-used" class="headerlink" title="Packages used:"></a>Packages used:</h3><p>limma</p>
<p>edgeR</p>
<p>gplots</p>
<p>org.Mm.eg.db</p>
<p>RColorBrewer</p>
<p>Glimma<a id="more"></a></p>
<h3 id="VMware-installation"><a href="#VMware-installation" class="headerlink" title="VMware installation:"></a>VMware installation:</h3><p><a href="http://www.zdfans.com/html/5928.html" target="_blank" rel="noopener">vmware-download</a></p>
<p><a href="http://environmentalomics.org/bio-linux-download/" target="_blank" rel="noopener">bio-linux-download</a></p>
<p><a href="http://environmentalomics.org/bio-linux-installation/" target="_blank" rel="noopener">bio-linux-installation</a></p>
<p><a href="https://www.jb51.net/softjc/189144.html" target="_blank" rel="noopener">vmware-tools-installation</a></p>
<p><a href="https://www.cnblogs.com/huangjianxin/p/6343881.html" target="_blank" rel="noopener">filessystem for share</a></p>
<p><a href="https://www.netsarang.com/download/down_form.html?code=622" target="_blank" rel="noopener">X shell-download</a></p>
<p><a href="http://www.bio-info-trainee.com/tag/%E6%9C%8D%E5%8A%A1%E5%99%A8" target="_blank" rel="noopener">other common questions</a></p>
<p><a href="http://blog.sina.com.cn/s/blog_54f07aba0101s1br.html" target="_blank" rel="noopener">R语言编辑器：notepad++</a></p>
<h2 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h2><ul>
<li>Reading in table of counts</li>
<li>Filtering lowly expressed genes</li>
<li>Quality control</li>
<li>Normalisation for composition bias</li>
<li>Differential expression analysis</li>
<li>Testing relative to a threshold</li>
<li>Visualisation</li>
<li>Gene set testing</li>
</ul>
<h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>There are many steps involved in analysising an RNA-Seq experiment. Analysising an RNASeq experiment begins with sequencing reads. These are aligned to a reference genome, then the number of reads mapped to each gene can be counted. This results in a table of counts, which is what we perform statistical analyses on in R. While mapping and counting are important and necessary tasks, today we will be starting from the count data and getting stuck into analysis.</p>
<h3 id="Data-import"><a href="#Data-import" class="headerlink" title="Data import"></a>Data import</h3><p>Load all the packages will need to analysis the data.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">library(edgeR)</span><br><span class="line">library(limma)</span><br><span class="line">library(Glimma)</span><br><span class="line">library(gplots)</span><br><span class="line">library(org.Mm.eg.db)</span><br><span class="line">library(RColorBrewer)</span><br></pre></td></tr></table></figure>
<h3 id="Mouse-mammary-gland-dataset"><a href="#Mouse-mammary-gland-dataset" class="headerlink" title="Mouse mammary gland dataset"></a>Mouse mammary gland dataset</h3><p>The data comes from a Nature Cell Biology paper, <a href="http://www.ncbi.nlm.nih.gov/pubmed/25730472" target="_blank" rel="noopener"><em>EGF-mediated induction of Mcl-1 at the switch to lactation is essential for alveolar cell survival</em></a>. Both the raw data (sequence reads) and processed data (counts) can be downloaded from <a href="http://www.ncbi.nlm.nih.gov/geo/query/acc.cgi?acc=GSE60450" target="_blank" rel="noopener">GSE60450</a>.</p>
<p>This study examines the expression profiles of basal stem-cell enriched cells (B) and committed luminal cells (L) in the mammary gland of virgin, pregnant  and lactating mice. Six groups are present, with one for each combination of cell type and mouse status. Each group contains two biological replicates. We will first use the counts file as a starting point for out analysis. This data has already been aligned to the mouse genome.</p>
<h3 id="Reading-in-the-data"><a href="#Reading-in-the-data" class="headerlink" title="Reading in the data"></a>Reading in the data</h3><p>Download and read in the data.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># Read the data into R</span><br><span class="line">seqdata &lt;- read.delim(&quot;GSE60450_Lactation-GenewiseCounts.txt&quot;, stringsAsFactors = FALSE)</span><br><span class="line"># Read the sample information into R</span><br><span class="line">sampleinfo &lt;- read.delim(&quot;SampleInfo.txt&quot;)</span><br><span class="line"># Take a look at the data</span><br><span class="line">head(seqdata)</span><br><span class="line"># See how many rows and columns the data frame has</span><br><span class="line">dim(seqdata)</span><br></pre></td></tr></table></figure>
<p>The <code>seqdata</code> object contains information about genes, the first column has the Entrez gene id, the second has the gene length and the remaining columns contain information about the number of reads aligning to the gene in each experimental sample. The sampleinfo file contains basic information about the samples that we will need for the analysis today.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sampleinfo</span><br></pre></td></tr></table></figure>
<p>We will manipulate and reformat the counts matrix into a suitable format for downstream analysis. The first columns in the <code>seqdata</code> dataframe contain annotation information. We need to make a new matrix containing only the counts, but we can store the gene identifiers (the <code>EntrezGeneID</code> column) as rownames. We will add more annotation information about each gene later on in the workshop.</p>
<h3 id="Format-the-data"><a href="#Format-the-data" class="headerlink" title="Format the data"></a>Format the data</h3><p>Create a new data object, <code>countdata</code>, that contains only the counts for the 12 samples.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"># Remove first two columns from seqdata</span><br><span class="line">countdata &lt;- seqdata[,-(1:2)]</span><br><span class="line"># Look at the output</span><br><span class="line">head(countdata)</span><br><span class="line"># Store EntrezGeneID as rownames</span><br><span class="line">rownames(countdata) &lt;- seqdata[,1]</span><br><span class="line"># Take a look at the output</span><br><span class="line">head(countdata)</span><br><span class="line"># Take a look at the column names</span><br><span class="line">colnames(countdata)</span><br></pre></td></tr></table></figure>
<p>The sample names are pretty long, so we’ll shorten these to contain only the relevant information about each sample. We will use the <code>substr</code> command to extract the first 7 characters and use these as the colnames.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># using substr, you extract the characters starting at position 1 and stopping at position 7 of the colnames</span><br><span class="line">colnames(countdata) &lt;- substr(colnames(countdata),start=1,stop=7)</span><br><span class="line"># Take a look at the output</span><br><span class="line">head(countdata)</span><br></pre></td></tr></table></figure>
<p>The column names are now the same as <code>SampleName</code> in the <code>sampleinfo</code> file, which means the sample information in <code>sampleinfo</code> is in the same order as the columns in  <code>countdata</code>.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">table(colnames(countdata)==sampleinfo$SampleName)</span><br></pre></td></tr></table></figure>
<h3 id="Filtering-to-remove-lowly-expressed-genes"><a href="#Filtering-to-remove-lowly-expressed-genes" class="headerlink" title="Filtering to remove lowly expressed genes"></a>Filtering to remove lowly expressed genes</h3><p><strong>Genes with very low counts</strong> across all libraries provide little evidence for differential expression and they interfere with some of the statistical approximations that are used later. They also add to the multiple testing burden when estimating false discovery rates, reducing power to detect differentially expressed genes. These genes <strong>should be filtered out prior to further analysis</strong>.</p>
<p>There are a few ways to filter out lowly expressed genes. When there are biological replicates in each group, in this case we have a sample size of 2 in each group, we favour filtering on a minimum counts per million threshold present in at least 2 samples. Two represents the smallest sample size for each group in out experiment. In this dataset, we choose to retain genes if they are expressed at a counts-per-million (CPM) above 0.5 in at least two samples.</p>
<p>We will use the <code>cpm</code> function from the <em>edgeR</em> library to generate the CPM values and then filter.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="https://cldiao.github.io/2018/07/29/RNA-Seq analysis in R/" data-id="cju0z1o4p000an4mvbswe6dwh" class="article-share-link">Share</a>
      
<section id="comments">
<!-- 多说评论框 start -->
  <div class="ds-thread" data-thread-key="2018/07/29/RNA-Seq analysis in R/" data-title="RNA-Seq analysis in R(EDITING)" data-url=""></div>
<!-- 多说评论框 end -->
<!-- 多说公共JS代码 start (一个网页只需插入一次) -->
<script type="text/javascript">
var duoshuoQuery = {short_name:"chaooo"};
  (function() {
    var ds = document.createElement('script');
    ds.type = 'text/javascript';ds.async = true;
    ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
    ds.charset = 'UTF-8';
    (document.getElementsByTagName('head')[0] 
     || document.getElementsByTagName('body')[0]).appendChild(ds);
  })();
  </script>
<!-- 多说公共JS代码 end -->
</section>

      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/LINUX-VMware-RNA-Seq-R/">LINUX, VMware, RNA-Seq, R</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2018/09/01/Mac上安装一些应用/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          Mac上安装一些应用
        
      </div>
    </a>
  
  
    <a href="/2017/10/17/RNA-Seq入门系列/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">RNA-Seq入门系列</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/GEO/" style="font-size: 10px;">GEO</a> <a href="/tags/GSEA/" style="font-size: 10px;">GSEA</a> <a href="/tags/GSEA/" style="font-size: 10px;">GSEA,</a> <a href="/tags/LINUX-VMware-RNA-Seq-R/" style="font-size: 10px;">LINUX, VMware, RNA-Seq, R</a> <a href="/tags/Linux-shell-bash/" style="font-size: 10px;">Linux, shell, bash</a> <a href="/tags/Mac-office-Vmware-fusion-Ps，Adobe/" style="font-size: 10px;">Mac, office, Vmware fusion, Ps，Adobe</a> <a href="/tags/Pubmed-R-visualization/" style="font-size: 10px;">Pubmed, R, visualization</a> <a href="/tags/R-表达矩阵，heatmap-PCA-T检验，火山图，ID转换/" style="font-size: 10px;">R, 表达矩阵，heatmap, PCA, T检验，火山图，ID转换</a> <a href="/tags/R2-database-correlation/" style="font-size: 10px;">R2, database, correlation</a> <a href="/tags/RNA-Seq/" style="font-size: 10px;">RNA-Seq</a> <a href="/tags/SP-FCAS/" style="font-size: 10px;">SP, FCAS</a> <a href="/tags/TFBS/" style="font-size: 10px;">TFBS</a> <a href="/tags/blog-hexo-github/" style="font-size: 10px;">blog,hexo,github</a> <a href="/tags/linux-shell-bash/" style="font-size: 20px;">linux, shell, bash</a> <a href="/tags/lipoplex/" style="font-size: 10px;">lipoplex</a> <a href="/tags/markdown/" style="font-size: 10px;">markdown</a> <a href="/tags/scholar-IF-publications/" style="font-size: 10px;">scholar, IF, publications</a> <a href="/tags/windows10-activation/" style="font-size: 10px;">windows10, activation</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2019/03/30/Linux命令行与shell脚本编程学习第五章/">Linux命令行与shell脚本编程大全学习第五章</a>
          </li>
        
          <li>
            <a href="/2019/03/27/win10安装/">win10 installation and activation</a>
          </li>
        
          <li>
            <a href="/2018/12/22/linux命令行与shell脚本编程大全学习笔记第四章/">linux命令行与shell脚本编程大全学习笔记第四章</a>
          </li>
        
          <li>
            <a href="/2018/12/22/preparation-of-lipoplex/">preparation of lipoplex</a>
          </li>
        
          <li>
            <a href="/2018/12/21/side-population-assay/">side population assay</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2019 Chaoliang Diao<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
    <a href="/about" class="mobile-nav-link">About</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css">
  <script src="/fancybox/jquery.fancybox.pack.js"></script>


<script src="/js/script.js"></script>



  </div>
</body>
</html>